# Logrotate configuration for Laravel container
# Rotates logs daily to prevent disk space issues

# Main nginx logs
/tmp/nginx-access.log /tmp/nginx-error.log {
    daily
    rotate 7
    compress
    delaycompress
    missingok
    notifempty
    create 644 www-data www-data
    maxsize 100M
    prerotate
        if [ -f /var/run/nginx.pid ]; then
            kill -USR1 `cat /var/run/nginx.pid`
        fi
    endscript
}

# PHP-FPM logs
/tmp/php8.3-fpm-error.log /tmp/php8.3-fpm-access.log /tmp/php8.3-fpm-slow.log /tmp/php8.3-fpm-www-error.log {
    daily
    rotate 7
    compress
    delaycompress
    missingok
    notifempty
    create 644 www-data www-data
    maxsize 50M
    postrotate
        if [ -f /tmp/php8.3-fpm.pid ]; then
            kill -USR1 `cat /tmp/php8.3-fpm.pid`
        fi
    endscript
}

# Supervisor logs
/tmp/supervisord.log /tmp/nginx-supervisor.log /tmp/php-fpm-supervisor.log /tmp/queue-supervisor.log /tmp/schedule-supervisor.log /tmp/cron-supervisor.log /tmp/logrotate-supervisor.log {
    daily
    rotate 5
    compress
    delaycompress
    missingok
    notifempty
    create 644 root root
    maxsize 25M
    postrotate
        supervisorctl reread
        supervisorctl update
    endscript
}

# OPcache logs
/tmp/opcache.log {
    daily
    rotate 3
    compress
    delaycompress
    missingok
    notifempty
    create 644 www-data www-data
    maxsize 10M
}

# Laravel application logs
/var/www/html/storage/logs/*.log {
    daily
    rotate 14
    compress
    delaycompress
    missingok
    notifempty
    create 644 www-data www-data
    maxsize 100M
}

# Laravel error logs
/var/www/html/storage/logs/php_errors.log {
    daily
    rotate 7
    compress
    delaycompress
    missingok
    notifempty
    create 644 www-data www-data
    maxsize 50M
} 